\section{Introduction}

Algorand is a platform for secure and decentralized digital currencies and transactions~[CITE]. At the core of the Algorand platform is the Algorand consensus protocol, a pure Proof-of-Stake (PoS)~[CITE] protocol that provides efficient, secure, and scalable operation while remaining decentralized. The basic idea in pure PoS is to make the security of the system dependent only on how honest the majority of its asset owners are, without having to rely on any specific small subset of participants or having to lock up assets and penalize users.

Consensus protocols in general are inherently complex. They involve interaction between many independent and potentially untrusted nodes in a large network where asynchronous and failure-prone communication is the norm rather than the exception. Furthermore, Algorand, in particular, describes not only the nodes' internal behavior, but also deals with message propagation and delivery, to be able to address two types of attacks: (1) attacks that corrupt participating nodes so that they no longer follow the protocol, e.g., to produce blocks with fake transactions or to cast votes for the wrong block, and (2) attacks on the underlying network in which the system is deployed, for instance by intercepting, manipulating and delaying messages. When an attacker gains full control of message delivery in a network, the network is said to be partitioned. Most existing consensus protocols do not consider what happens when a network is partitioned or after the network recovers from a partition.

Consequently, ensuring correctness and resilience against malicious behavior while designing such a protocol is a challenging task, and its importance cannot be overemphasized. Since consensus systems are the backbone of large cryptocurrencies worth billions of US dollars, vulnerabilities can have potentially catastrophic consequences~[CITE]. Having strong formal guarantees of correctness and developing a deep understanding of their assumptions can significantly reduce the possibility of such events happening.

To achieve the highest levels of assurance, we chose deductive verification, in which systems are modeled and specified inside expressive formal logical systems, and verified in a similar way to how mathematicians prove theorems - in principle by elaborating proofs of statements step-by-step. Among the large spectrum of formal techniques, deductive verification provides the strongest guarantees, and thus the highest degree of trustworthiness, but at the expense of being the most demanding. % (see the chart in Figure~\ref{fig:verification}).

We used Coq, which is a proof assistant based on type theory, for our deductive verification effort. Coq is developed for more than 30 years and very well supported. Coq has previously been used to develop a verified C compiler, formally prove mathematical results such as the four-color theorem, and verify distributed protocols (see, for example, our previous Casper formal verification effort for the Ethereum Foundation).

We developed a model of the Algorand consensus protocol in Coq, and proved a slew of its properties that we then used to ultimately show the asynchronous safety property: no two honest nodes certify two different blocks, even when the adversary has complete control of message delivery in the network. This report describes our effort to model the protocol and specify and verify its properties. Moreover, we describe the formalization of the assumptions under which the safety theorem holds. Beyond the safety theorem, we intend for this formalization in Coq to lay the foundation for further future modeling and verification efforts of the Algorand consensus protocol.

%A key characteristic of Algorand is that it almost never forks. Forking happens when consensus on a single block for a round is not reached and multiple candidate blocks are available for that round. Having different subsets of nodes decide on appending different blocks to the chain means that transactions appearing in these conflicting blocks are not finalized since only one of these blocks will eventually belong to the canonical chain, the chain that is deemed most accepted by the nodes (there are different methods for deciding the canonical chain, e.g. the longest chain in Bitcoin). Algorand avoids this problem by design: at most one block can receive the majority of votes in a round. This property implies that once a block of transactions appear in the chain, they can immediately be considered final. This has the potential of allowing extremely high levels of scalability. This no-forking property is referred to as Asynchronous safety, which states that no two honest nodes will certify two different blocks, even when the adversary has complete control of message delivery in the network. 
